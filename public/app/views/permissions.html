<div class="container">
    <div class="row">
        <h1 class="">
            <span>Permisos</span>
            <button class="btn btn-transparent fa fa-plus-circle" ng-click="openModal()" uib-tooltip="Agregar permiso" ng-if="isAdmin || isGestor">
            </button>
        </h1>
    </div>
    <div class="row">
        <div class="col-md-8 col-md-offset-2">
            <table st-table="displayed" st-safe-src="permissions" class="table table-hover table-striped table-responsive">
                <thead>
                <tr>
                    <th st-sort="from" style="cursor: pointer">Desde</th>
                    <th st-sort="until" style="cursor: pointer">Hasta</th>
                    <th>Usuarios Permitidos</th>
                    <th></th>
                </tr>
                </thead>
                <tbody>
                <tr ng-repeat="permission in displayed" ng-if="permissions.length > 0">
                    <td>{{permission.from | date:'dd/MM/yyyy'}}</td>
                    <td>{{permission.until | date:'dd/MM/yyyy'}}</td>
                    <td>
                        <p ng-if="permission.users.length > 0" ng-repeat="user in permission.users">
                            {{user.name}}
                        </p>
                        <p ng-if="permission.users.length === 0">
                            No hay usuarios permitidos
                        </p>
                    </td>
                    <td>
                        <a ng-if="isAdmin || isGestor" ng-click="openModal(permission)" class="col-md-2 col-xs-6" uib-tooltip="Editar permiso">
                            <i class="glyphicon glyphicon-pencil"></i>
                        </a>
                        <a ng-if="isAdmin" ng-click="delete(permission._id)" class="col-md-2 col-md-offset-2 col-xs-6 col-xs-offset-0" uib-tooltip="Eliminar permiso">
                            <i class="glyphicon glyphicon-trash" style="color: rgb(210,50,50);"></i>
                        </a>
                    </td>
                </tr>
                <tr ng-if="permissions.length === 0">
                    <td colspan="4">
                        <p class="text-center">
                            No hay permisos registrados
                        </p>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
<script type="text/ng-template" id="modal.html">
    <div class="modal-header">
        <h3> {{form.from ? 'Actualizar' : 'Agregar'}} Permiso</h3>
    </div>
    <div class="modal-body">
        <form name="formulario">
            <div class="form-group" ng-if="isAdmin || isGestor">
                    <label>Desde</label>
                    <datetimepicker class="col-md-12"
                                    hour-step="1"
                                    minute-step="5" ng-model="form.from" show-meridian="true"
                                    date-format="dd/MM/yyyy" date-options="dateOptions"
                                    datepicker-append-to-body="false"
                                    readonly-time="true"
                                    readonly-date="false"
                                    name="datetimepicker"
                                    show-spinners="true"
                                    current-text="Hoy"
                                    clear-text="Limpiar"
                                    close-text="Cerrar">
                    </datetimepicker>
            </div>
            <div class="form-group" ng-if="isAdmin || isGestor">
                    <label>Hasta</label>
                    <datetimepicker class="col-md-12"
                                    hour-step="1"
                                    minute-step="5" ng-model="form.until" show-meridian="true"
                                    date-format="dd/MM/yyyy" date-options="dateOptions"
                                    datepicker-append-to-body="false"
                                    readonly-date="false"
                                    hidden-time="false"
                                    hidden-date="false"
                                    name="datetimepicker"
                                    show-spinners="true"
                                    current-text="Hoy"
                                    clear-text="Limpiar"
                                    close-text="Cerrar">
                    </datetimepicker>
            </div>
            <div class="form-group">
                <label>Usuarios permitidos</label>
                <div ng-dropdown-multiselect required
                     options="auditors"
                     selected-model="form.users"
                     translation-texts="translations"
                     checkboxes="true">
                </div>
            </div>
            <div class="form-group">
                <div class="alert alert-danger" ng-class="{hidden: !err}">
                    {{err}}
                </div>
            </div>
        </form>
    </div>
    <div class="modal-footer">
        <button class="btn btn-primary" type="button" ng-click="addPermission(form)">{{form.from ? 'Actualizar' : 'Agregar'}}</button>
        <button class="btn btn-default" type="button" ng-click="cancel()">Cancelar</button>
    </div>
</script>
